"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const keychain_1 = require("src/apis/platformvm/keychain");
const index_1 = require("src/index");
const buffer_1 = require("buffer/");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("src/utils/bintools"));
const bintools = bintools_1.default.getInstance();
const alias = 'P';
const hrp = "tests";
describe('PlatformVMKeyPair', () => {
    const networkid = 12345;
    const ip = '127.0.0.1';
    const port = 9650;
    const protocol = 'https';
    const avalanche = new index_1.Avalanche(ip, port, protocol, networkid, undefined, undefined, true);
    test('human readable part', () => {
        let hrp = avalanche.getHRP();
        let networkID = avalanche.getNetworkID();
        expect(hrp).toBe("local");
        expect(networkID).toBe(12345);
        avalanche.setNetworkID(2);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("cascade");
        expect(networkID).toBe(2);
        avalanche.setNetworkID(3);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("denali");
        expect(networkID).toBe(3);
        avalanche.setNetworkID(4);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("everest");
        expect(networkID).toBe(4);
        avalanche.setNetworkID(0);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("custom");
        expect(networkID).toBe(0);
        avalanche.setNetworkID(1);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("avax");
        expect(networkID).toBe(1);
        avalanche.setNetworkID(12345);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("local");
        expect(networkID).toBe(12345);
    });
    test('repeatable 1', () => {
        const kp = new keychain_1.PlatformVMKeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('ef9bf2d4436491c153967c9709dd8e82795bdb9b5ad44ee22c2903005d1cf676', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('033fad3644deb20d7a210d12757092312451c112d04773cee2699fbb59dc8bb2ef');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('repeatable 2', () => {
        const kp = new keychain_1.PlatformVMKeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('17c692d4a99d12f629d9f0ff92ec0dba15c9a83e85487b085c1a3018286995c6', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('02486553b276cfe7abf0efbcd8d173e55db9c03da020c33d0b219df24124da18ee');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('repeatable 3', () => {
        const kp = new keychain_1.PlatformVMKeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('031475b91d4fcf52979f1cf107f058088cc2bea6edd51915790f27185a7586e2f2');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('Creation Empty', () => {
        const kp = new keychain_1.PlatformVMKeyPair(hrp, alias);
        expect(kp.getPrivateKey()).not.toBeUndefined();
        expect(kp.getAddress()).not.toBeUndefined();
        expect(kp.getPrivateKeyString()).not.toBeUndefined();
        expect(kp.getPublicKey()).not.toBeUndefined();
        expect(kp.getPublicKeyString()).not.toBeUndefined();
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
});
describe('PlatformVMKeyChain', () => {
    test('importKey from Buffer', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.PlatformVMKeyChain(hrp, alias);
        const kp2 = new keychain_1.PlatformVMKeyPair(hrp, alias);
        const addr1 = kc.importKey(keybuff);
        const kp1 = kc.getKey(addr1);
        kp2.importKey(keybuff);
        const addr2 = kp1.getAddress();
        expect(addr1.toString('hex')).toBe(addr2.toString('hex'));
        expect(kp1.getPrivateKeyString()).toBe(kp2.getPrivateKeyString());
        expect(kp1.getPublicKeyString()).toBe(kp2.getPublicKeyString());
        expect(kc.hasKey(addr1)).toBe(true);
    });
    test('importKey from serialized string', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.PlatformVMKeyChain(hrp, alias);
        const kp2 = new keychain_1.PlatformVMKeyPair(hrp, alias);
        const addr1 = kc.importKey("PrivateKey-" + bintools.cb58Encode(keybuff));
        const kp1 = kc.getKey(addr1);
        kp2.importKey(keybuff);
        const addr2 = kp1.getAddress();
        expect(addr1.toString('hex')).toBe(addr2.toString('hex'));
        expect(kp1.getPrivateKeyString()).toBe(kp2.getPrivateKeyString());
        expect(kp1.getPublicKeyString()).toBe(kp2.getPublicKeyString());
        expect(kc.hasKey(addr1)).toBe(true);
    });
    test('removeKey via keypair', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.PlatformVMKeyChain(hrp, alias);
        const kp1 = new keychain_1.PlatformVMKeyPair(hrp, alias);
        const addr1 = kc.importKey(keybuff);
        kp1.importKey(keybuff);
        expect(kc.hasKey(addr1)).toBe(true);
        kc.removeKey(kp1);
        expect(kc.hasKey(addr1)).toBe(false);
    });
    test('removeKey via string', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.PlatformVMKeyChain(hrp, alias);
        const addr1 = kc.importKey(keybuff);
        expect(kc.hasKey(addr1)).toBe(true);
        kc.removeKey(addr1);
        expect(kc.hasKey(addr1)).toBe(false);
    });
    test('removeKey bad keys', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.PlatformVMKeyChain(hrp, alias);
        const addr1 = kc.importKey(keybuff);
        expect(kc.hasKey(addr1)).toBe(true);
        expect(kc.removeKey(bintools.cb58Decode('6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV'))).toBe(false);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5Y2hhaW4udGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvcGxhdGZvcm12bS9rZXljaGFpbi50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkRBQXFGO0FBQ3JGLHFDQUFxQztBQUNyQyxvQ0FBaUM7QUFDakMsOERBQXFDO0FBQ3JDLGtFQUEwQztBQUUxQyxNQUFNLFFBQVEsR0FBRyxrQkFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQ3hDLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQztBQUNsQixNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUM7QUFDcEIsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxNQUFNLFNBQVMsR0FBVSxLQUFLLENBQUM7SUFDL0IsTUFBTSxFQUFFLEdBQVUsV0FBVyxDQUFDO0lBQzlCLE1BQU0sSUFBSSxHQUFVLElBQUksQ0FBQztJQUN6QixNQUFNLFFBQVEsR0FBVSxPQUFPLENBQUM7SUFDaEMsTUFBTSxTQUFTLEdBQWEsSUFBSSxpQkFBUyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRXJHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDL0IsSUFBSSxHQUFHLEdBQVUsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3BDLElBQUksU0FBUyxHQUFVLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNoRCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUIsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLFNBQVMsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTFCLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsR0FBRyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN6QixTQUFTLEdBQUcsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUxQixTQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDekIsU0FBUyxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNyQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUIsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLFNBQVMsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTFCLFNBQVMsQ0FBQyxZQUFZLENB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IHsgUGxhdGZvcm1WTUtleUNoYWluLCBQbGF0Zm9ybVZNS2V5UGFpciB9IGZyb20gJ3NyYy9hcGlzL3BsYXRmb3Jtdm0va2V5Y2hhaW4nO1xuaW1wb3J0IHsgQXZhbGFuY2hlIH0gZnJvbSAnc3JjL2luZGV4J1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSAnYnVmZmVyLyc7XG5pbXBvcnQgY3JlYXRlSGFzaCBmcm9tICdjcmVhdGUtaGFzaCc7XG5pbXBvcnQgQmluVG9vbHMgZnJvbSAnc3JjL3V0aWxzL2JpbnRvb2xzJztcblxuY29uc3QgYmludG9vbHMgPSBCaW5Ub29scy5nZXRJbnN0YW5jZSgpO1xuY29uc3QgYWxpYXMgPSAnUCc7XG5jb25zdCBocnAgPSBcInRlc3RzXCI7XG5kZXNjcmliZSgnUGxhdGZvcm1WTUtleVBhaXInLCAoKSA9PiB7XG4gIGNvbnN0IG5ldHdvcmtpZDpudW1iZXIgPSAxMjM0NTtcbiAgY29uc3QgaXA6c3RyaW5nID0gJzEyNy4wLjAuMSc7XG4gIGNvbnN0IHBvcnQ6bnVtYmVyID0gOTY1MDtcbiAgY29uc3QgcHJvdG9jb2w6c3RyaW5nID0gJ2h0dHBzJztcbiAgY29uc3QgYXZhbGFuY2hlOkF2YWxhbmNoZSA9IG5ldyBBdmFsYW5jaGUoaXAsIHBvcnQsIHByb3RvY29sLCBuZXR3b3JraWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0cnVlKTtcblxuICB0ZXN0KCdodW1hbiByZWFkYWJsZSBwYXJ0JywgKCkgPT4ge1xuICAgIGxldCBocnA6c3RyaW5nID0gYXZhbGFuY2hlLmdldEhSUCgpO1xuICAgIGxldCBuZXR3b3JrSUQ6bnVtYmVyID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJsb2NhbFwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDEyMzQ1KTtcblxuICAgIGF2YWxhbmNoZS5zZXROZXR3b3JrSUQoMik7XG4gICAgaHJwID0gYXZhbGFuY2hlLmdldEhSUCgpO1xuICAgIG5ldHdvcmtJRCA9IGF2YWxhbmNoZS5nZXROZXR3b3JrSUQoKTtcbiAgICBleHBlY3QoaHJwKS50b0JlKFwiY2FzY2FkZVwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDIpO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgzKTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJkZW5hbGlcIik7XG4gICAgZXhwZWN0KG5ldHdvcmtJRCkudG9CZSgzKTtcblxuICAgIGF2YWxhbmNoZS5zZXROZXR3b3JrSUQoNCk7XG4gICAgaHJwID0gYXZhbGFuY2hlLmdldEhSUCgpO1xuICAgIG5ldHdvcmtJRCA9IGF2YWxhbmNoZS5nZXROZXR3b3JrSUQoKTtcbiAgICBleHBlY3QoaHJwKS50b0JlKFwiZXZlcmVzdFwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDQpO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgwKTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJjdXN0b21cIik7XG4gICAgZXhwZWN0KG5ldHdvcmtJRCkudG9CZSgwKTtcblxuICAgIGF2YWxhbmNoZS5zZXROZXR3b3JrSUQoMSk7XG4gICAgaHJwID0gYXZhbGFuY2hlLmdldEhSUCgpO1xuICAgIG5ldHdvcmtJRCA9IGF2YWxhbmNoZS5nZXROZXR3b3JrSUQoKTtcbiAgICBleHBlY3QoaHJwKS50b0JlKFwiYXZheFwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDEpO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgxMjM0NSk7XG4gICAgaHJwID0gYXZhbGFuY2hlLmdldEhSUCgpO1xuICAgIG5ldHdvcmtJRCA9IGF2YWxhbmNoZS5nZXROZXR3b3JrSUQoKTtcbiAgICBleHBlY3QoaHJwKS50b0JlKFwibG9jYWxcIik7XG4gICAgZXhwZWN0KG5ldHdvcmtJRCkudG9CZSgxMjM0NSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlcGVhdGFibGUgMScsICgpID0+IHtcbiAgICBjb25zdCBrcDpQbGF0Zm9ybVZNS2V5UGFpciA9IG5ldyBQbGF0Zm9ybVZNS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBrcC5pbXBvcnRLZXkoQnVmZmVyLmZyb20oJ2VmOWJmMmQ0NDM2NDkxYzE1Mzk2N2M5NzA5ZGQ4ZTgyNzk1YmRiOWI1YWQ0NGVlMjJjMjkwMzAwNWQxY2Y2NzYnLCAnaGV4JykpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKS50b1N0cmluZygnaGV4JykpLnRvQmUoJzAzM2ZhZDM2NDRkZWIyMGQ3YTIxMGQxMjc1NzA5MjMxMjQ1MWMxMTJkMDQ3NzNjZWUyNjk5ZmJiNTlkYzhiYjJlZicpO1xuXG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVwZWF0YWJsZSAyJywgKCkgPT4ge1xuICAgIGNvbnN0IGtwOlBsYXRmb3JtVk1LZXlQYWlyID0gbmV3IFBsYXRmb3JtVk1LZXlQYWlyKGhycCwgYWxpYXMpO1xuICAgIGtwLmltcG9ydEtleShCdWZmZXIuZnJvbSgnMTdjNjkyZDRhOTlkMTJmNjI5ZDlmMGZmOTJlYzBkYmExNWM5YTgzZTg1NDg3YjA4NWMxYTMwMTgyODY5OTVjNicsICdoZXgnKSk7XG4gICAgZXhwZWN0KGtwLmdldFB1YmxpY0tleSgpLnRvU3RyaW5nKCdoZXgnKSkudG9CZSgnMDI0ODY1NTNiMjc2Y2ZlN2FiZjBlZmJjZDhkMTczZTU1ZGI5YzAzZGEwMjBjMzNkMGIyMTlkZjI0MTI0ZGExOGVlJyk7XG5cbiAgICBjb25zdCBtc2c6QnVmZmVyID0gQnVmZmVyLmZyb20oY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKEJ1ZmZlci5mcm9tKCcwOTA5MDkwOScsICdoZXgnKSkuZGlnZXN0KCdoZXgnKSwgJ2hleCcpO1xuICAgIGNvbnN0IHNpZzpCdWZmZXIgPSBrcC5zaWduKG1zZyk7XG5cbiAgICBleHBlY3Qoc2lnLmxlbmd0aCkudG9CZSg2NSk7XG4gICAgZXhwZWN0KGtwLnZlcmlmeShtc2csIHNpZykpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGtwLnJlY292ZXIobXNnLCBzaWcpLnRvU3RyaW5nKCdoZXgnKSkudG9CZShrcC5nZXRQdWJsaWNLZXkoKS50b1N0cmluZygnaGV4JykpO1xuICB9KTtcblxuICB0ZXN0KCdyZXBlYXRhYmxlIDMnLCAoKSA9PiB7XG4gICAgY29uc3Qga3A6UGxhdGZvcm1WTUtleVBhaXIgPSBuZXcgUGxhdGZvcm1WTUtleVBhaXIoaHJwLCBhbGlhcyk7XG4gICAga3AuaW1wb3J0S2V5KEJ1ZmZlci5mcm9tKCdkMGUxN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpKTtcbiAgICBleHBlY3Qoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKS50b0JlKCcwMzE0NzViOTFkNGZjZjUyOTc5ZjFjZjEwN2YwNTgwODhjYzJiZWE2ZWRkNTE5MTU3OTBmMjcxODVhNzU4NmUyZjInKTtcblxuICAgIGNvbnN0IG1zZzpCdWZmZXIgPSBCdWZmZXIuZnJvbShjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUoQnVmZmVyLmZyb20oJzA5MDkwOTA5JywgJ2hleCcpKS5kaWdlc3QoJ2hleCcpLCAnaGV4Jyk7XG4gICAgY29uc3Qgc2lnOkJ1ZmZlciA9IGtwLnNpZ24obXNnKTtcblxuICAgIGV4cGVjdChzaWcubGVuZ3RoKS50b0JlKDY1KTtcbiAgICBleHBlY3Qoa3AudmVyaWZ5KG1zZywgc2lnKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3Qoa3AucmVjb3Zlcihtc2csIHNpZykudG9TdHJpbmcoJ2hleCcpKS50b0JlKGtwLmdldFB1YmxpY0tleSgpLnRvU3RyaW5nKCdoZXgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ0NyZWF0aW9uIEVtcHR5JywgKCkgPT4ge1xuICAgIGNvbnN0IGtwOlBsYXRmb3JtVk1LZXlQYWlyID0gbmV3IFBsYXRmb3JtVk1LZXlQYWlyKGhycCwgYWxpYXMpO1xuICAgIGV4cGVjdChrcC5nZXRQcml2YXRlS2V5KCkpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgZXhwZWN0KGtwLmdldEFkZHJlc3MoKSkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3Qoa3AuZ2V0UHJpdmF0ZUtleVN0cmluZygpKS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKSkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3Qoa3AuZ2V0UHVibGljS2V5U3RyaW5nKCkpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1BsYXRmb3JtVk1LZXlDaGFpbicsICgpID0+IHtcbiAgdGVzdCgnaW1wb3J0S2V5IGZyb20gQnVmZmVyJywgKCkgPT4ge1xuICAgIGNvbnN0IGtleWJ1ZmY6QnVmZmVyID0gQnVmZmVyLmZyb20oJ2QwZTE3ZDRiMzEzODBmOTZhNDJiM2U5ZmZjNGMxYjJhOTM1ODlhMWU1MWQ4NmQ3ZWRjMTA3ZjYwMmZiYzc0NzUnLCAnaGV4Jyk7XG4gICAgY29uc3Qga2M6UGxhdGZvcm1WTUtleUNoYWluID0gbmV3IFBsYXRmb3JtVk1LZXlDaGFpbihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBrcDI6UGxhdGZvcm1WTUtleVBhaXIgPSBuZXcgUGxhdGZvcm1WTUtleVBhaXIoaHJwLCBhbGlhcyk7XG4gICAgY29uc3QgYWRkcjE6QnVmZmVyID0ga2MuaW1wb3J0S2V5KGtleWJ1ZmYpO1xuICAgIGNvbnN0IGtwMTpQbGF0Zm9ybVZNS2V5UGFpciA9IGtjLmdldEtleShhZGRyMSk7XG4gICAga3AyLmltcG9ydEtleShrZXlidWZmKTtcbiAgICBjb25zdCBhZGRyMiA9IGtwMS5nZXRBZGRyZXNzKCk7XG4gICAgZXhwZWN0KGFkZHIxLnRvU3RyaW5nKCdoZXgnKSkudG9CZShhZGRyMi50b1N0cmluZygnaGV4JykpO1xuICAgIGV4cGVjdChrcDEuZ2V0UHJpdmF0ZUtleVN0cmluZygpKS50b0JlKGtwMi5nZXRQcml2YXRlS2V5U3RyaW5nKCkpO1xuICAgIGV4cGVjdChrcDEuZ2V0UHVibGljS2V5U3RyaW5nKCkpLnRvQmUoa3AyLmdldFB1YmxpY0tleVN0cmluZygpKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZSh0cnVlKTtcbiAgfSk7XG5cbiAgdGVzdCgnaW1wb3J0S2V5IGZyb20gc2VyaWFsaXplZCBzdHJpbmcnLCAoKSA9PiB7XG4gICAgY29uc3Qga2V5YnVmZjpCdWZmZXIgPSBCdWZmZXIuZnJvbSgnZDBlMTdkNGIzMTM4MGY5NmE0MmIzZTlmZmM0YzFiMmE5MzU4OWExZTUxZDg2ZDdlZGMxMDdmNjAyZmJjNzQ3NScsICdoZXgnKTtcbiAgICBjb25zdCBrYzpQbGF0Zm9ybVZNS2V5Q2hhaW4gPSBuZXcgUGxhdGZvcm1WTUtleUNoYWluKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGtwMjpQbGF0Zm9ybVZNS2V5UGFpciA9IG5ldyBQbGF0Zm9ybVZNS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBhZGRyMTpCdWZmZXIgPSBrYy5pbXBvcnRLZXkoXCJQcml2YXRlS2V5LVwiICsgYmludG9vbHMuY2I1OEVuY29kZShrZXlidWZmKSk7XG4gICAgY29uc3Qga3AxOlBsYXRmb3JtVk1LZXlQYWlyID0ga2MuZ2V0S2V5KGFkZHIxKTtcbiAgICBrcDIuaW1wb3J0S2V5KGtleWJ1ZmYpO1xuICAgIGNvbnN0IGFkZHIyID0ga3AxLmdldEFkZHJlc3MoKTtcbiAgICBleHBlY3QoYWRkcjEudG9TdHJpbmcoJ2hleCcpKS50b0JlKGFkZHIyLnRvU3RyaW5nKCdoZXgnKSk7XG4gICAgZXhwZWN0KGtwMS5nZXRQcml2YXRlS2V5U3RyaW5nKCkpLnRvQmUoa3AyLmdldFByaXZhdGVLZXlTdHJpbmcoKSk7XG4gICAgZXhwZWN0KGtwMS5nZXRQdWJsaWNLZXlTdHJpbmcoKSkudG9CZShrcDIuZ2V0UHVibGljS2V5U3RyaW5nKCkpO1xuICAgIGV4cGVjdChrYy5oYXNLZXkoYWRkcjEpKS50b0JlKHRydWUpO1xuICB9KTtcblxuICB0ZXN0KCdyZW1vdmVLZXkgdmlhIGtleXBhaXInLCAoKSA9PiB7XG4gICAgY29uc3Qga2V5YnVmZjpCdWZmZXIgPSBCdWZmZXIuZnJvbSgnZDBlMTdkNGIzMTM4MGY5NmE0MmIzZTlmZmM0YzFiMmE5MzU4OWExZTUxZDg2ZDdlZGMxMDdmNjAyZmJjNzQ3NScsICdoZXgnKTtcbiAgICBjb25zdCBrYzpQbGF0Zm9ybVZNS2V5Q2hhaW4gPSBuZXcgUGxhdGZvcm1WTUtleUNoYWluKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGtwMTpQbGF0Zm9ybVZNS2V5UGFpciA9IG5ldyBQbGF0Zm9ybVZNS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBhZGRyMTpCdWZmZXIgPSBrYy5pbXBvcnRLZXkoa2V5YnVmZik7XG4gICAga3AxLmltcG9ydEtleShrZXlidWZmKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZSh0cnVlKTtcbiAgICBrYy5yZW1vdmVLZXkoa3AxKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZShmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlbW92ZUtleSB2aWEgc3RyaW5nJywgKCkgPT4ge1xuICAgIGNvbnN0IGtleWJ1ZmY6QnVmZmVyID0gQnVmZmVyLmZyb20oJ2QwZTE3ZDRiMzEzODBmOTZhNDJiM2U5ZmZjNGMxYjJhOTM1ODlhMWU1MWQ4NmQ3ZWRjMTA3ZjYwMmZiYzc0NzUnLCAnaGV4Jyk7XG4gICAgY29uc3Qga2M6UGxhdGZvcm1WTUtleUNoYWluID0gbmV3IFBsYXRmb3JtVk1LZXlDaGFpbihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBhZGRyMTpCdWZmZXIgPSBrYy5pbXBvcnRLZXkoa2V5YnVmZik7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUodHJ1ZSk7XG4gICAga2MucmVtb3ZlS2V5KGFkZHIxKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZShmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlbW92ZUtleSBiYWQga2V5cycsICgpID0+IHtcbiAgICBjb25zdCBrZXlidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdkMGUxN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpO1xuICAgIGNvbnN0IGtjOlBsYXRmb3JtVk1LZXlDaGFpbiA9IG5ldyBQbGF0Zm9ybVZNS2V5Q2hhaW4oaHJwLCBhbGlhcyk7XG4gICAgY29uc3QgYWRkcjE6QnVmZmVyID0ga2MuaW1wb3J0S2V5KGtleWJ1ZmYpO1xuICAgIGV4cGVjdChrYy5oYXNLZXkoYWRkcjEpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrYy5yZW1vdmVLZXkoYmludG9vbHMuY2I1OERlY29kZSgnNlkza3lzakY5am5IbllrZFM5eUdBdW9IeWFlMmVObWVWJykpKS50b0JlKGZhbHNlKTtcbiAgfSk7XG59KTsiXX0=