"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("src/apis/avm/types");
const buffer_1 = require("buffer/");
const bintools_1 = __importDefault(require("src/utils/bintools"));
const bintools = bintools_1.default.getInstance();
describe('UnixNow', () => {
    test('Does it return the right time?', () => {
        const now = Math.round((new Date()).getTime() / 1000);
        const unow = types_1.UnixNow();
        expect(now / 10).toBeCloseTo(unow.divn(10).toNumber(), -1);
    });
});
describe('Signature & NBytes', () => {
    const sig = new types_1.Signature();
    const sigpop = [];
    for (let i = 0; i < sig.getSize(); i++) {
        sigpop[i] = i;
    }
    const sigbuff = buffer_1.Buffer.from(sigpop);
    const size = sig.fromBuffer(sigbuff);
    expect(sig.getSize()).toBe(size);
    expect(size).toBe(sig.getSize());
    const sigbuff2 = sig.toBuffer();
    for (let i = 0; i < sigbuff.length; i++) {
        expect(sigbuff2[i]).toBe(sigbuff[i]);
    }
    const sigbuffstr = bintools.bufferToB58(sigbuff);
    expect(sig.toString()).toBe(sigbuffstr);
    sig.fromString(sigbuffstr);
    expect(sig.toString()).toBe(sigbuffstr);
});
describe('SigIdx', () => {
    const sigidx = new types_1.SigIdx();
    expect(sigidx.getSize()).toBe(sigidx.toBuffer().length);
    sigidx.setSource(buffer_1.Buffer.from('abcd', 'hex'));
    expect(sigidx.getSource().toString('hex')).toBe('abcd');
});
describe('Address', () => {
    const addr1 = new types_1.Address();
    const addr2 = new types_1.Address();
    const smaller = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0];
    const bigger = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1, 1];
    const addr1bytes = buffer_1.Buffer.from(smaller);
    const addr2bytes = buffer_1.Buffer.from(bigger);
    addr1.fromBuffer(addr1bytes);
    addr2.fromBuffer(addr2bytes);
    expect(types_1.Address.comparator()(addr1, addr2)).toBe(-1);
    expect(types_1.Address.comparator()(addr2, addr1)).toBe(1);
    const addr2str = addr2.toString();
    addr2.fromBuffer(addr1bytes);
    expect(types_1.Address.comparator()(addr1, addr2)).toBe(0);
    addr2.fromString(addr2str);
    expect(types_1.Address.comparator()(addr1, addr2)).toBe(-1);
    const a1b = addr1.toBuffer();
    const a1s = bintools.bufferToB58(a1b);
    addr2.fromString(a1s);
    expect(types_1.Address.comparator()(addr1, addr2)).toBe(0);
    const badbuff = bintools.copyFrom(addr1bytes);
    let badbuffout = buffer_1.Buffer.concat([badbuff, buffer_1.Buffer.from([1, 2])]);
    let badstr = bintools.bufferToB58(badbuffout);
    const badaddr = new types_1.Address();
    expect(() => {
        badaddr.fromString(badstr);
    }).toThrow('Error - Address.fromString: invalid address');
    badbuffout = buffer_1.Buffer.concat([badbuff, buffer_1.Buffer.from([1, 2, 3, 4])]);
    badstr = bintools.bufferToB58(badbuffout);
    expect(() => {
        badaddr.fromString(badstr);
    }).toThrow('Error - Address.fromString: invalid checksum on address');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvYXZtL3R5cGVzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw4Q0FFNEI7QUFDNUIsb0NBQWlDO0FBQ2pDLGtFQUEwQztBQUUxQyxNQUFNLFFBQVEsR0FBWSxrQkFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBRWpELFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDMUMsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUN0RCxNQUFNLElBQUksR0FBRyxlQUFPLEVBQUUsQ0FBQztRQUN2QixNQUFNLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0QsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxpQkFBUyxFQUFFLENBQUM7SUFDNUIsTUFBTSxNQUFNLEdBQWlCLEVBQUUsQ0FBQztJQUNoQyxLQUFLLElBQUksQ0FBQyxHQUFVLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQzdDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDZjtJQUNELE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0MsTUFB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Q0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEUsSUFBSSxNQUFNLEdBQVUsUUFBUSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNyRCxNQUFNLE9BQU8sR0FBVyxJQUFJLGVBQU8sRUFBRSxDQUFDO0lBRXRDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO0lBRTFELFVBQVUsR0FBRyxlQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLGVBQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRSxNQUFNLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMxQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ1YsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM3QixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMseURBQXlELENBQUMsQ0FBQztBQUN4RSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFNpZ0lkeCwgU2lnbmF0dXJlLCBBZGRyZXNzLCBVbml4Tm93LFxufSBmcm9tICdzcmMvYXBpcy9hdm0vdHlwZXMnO1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSAnYnVmZmVyLyc7XG5pbXBvcnQgQmluVG9vbHMgZnJvbSAnc3JjL3V0aWxzL2JpbnRvb2xzJztcblxuY29uc3QgYmludG9vbHM6QmluVG9vbHMgPSBCaW5Ub29scy5nZXRJbnN0YW5jZSgpO1xuXG5kZXNjcmliZSgnVW5peE5vdycsICgpID0+IHtcbiAgdGVzdCgnRG9lcyBpdCByZXR1cm4gdGhlIHJpZ2h0IHRpbWU/JywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdyA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDEwMDApO1xuICAgIGNvbnN0IHVub3cgPSBVbml4Tm93KCk7XG4gICAgZXhwZWN0KG5vdyAvIDEwKS50b0JlQ2xvc2VUbyh1bm93LmRpdm4oMTApLnRvTnVtYmVyKCksIC0xKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1NpZ25hdHVyZSAmIE5CeXRlcycsICgpID0+IHtcbiAgY29uc3Qgc2lnID0gbmV3IFNpZ25hdHVyZSgpO1xuICBjb25zdCBzaWdwb3A6QXJyYXk8bnVtYmVyPiA9IFtdO1xuICBmb3IgKGxldCBpOm51bWJlciA9IDA7IGkgPCBzaWcuZ2V0U2l6ZSgpOyBpKyspIHtcbiAgICBzaWdwb3BbaV0gPSBpO1xuICB9XG4gIGNvbnN0IHNpZ2J1ZmY6QnVmZmVyID0gQnVmZmVyLmZyb20oc2lncG9wKTtcbiAgY29uc3Qgc2l6ZSA9IHNpZy5mcm9tQnVmZmVyKHNpZ2J1ZmYpO1xuICBleHBlY3Qoc2lnLmdldFNpemUoKSkudG9CZShzaXplKTtcbiAgZXhwZWN0KHNpemUpLnRvQmUoc2lnLmdldFNpemUoKSk7XG4gIGNvbnN0IHNpZ2J1ZmYyOkJ1ZmZlciA9IHNpZy50b0J1ZmZlcigpO1xuICBmb3IgKGxldCBpOm51bWJlciA9IDA7IGkgPCBzaWdidWZmLmxlbmd0aDsgaSsrKSB7XG4gICAgZXhwZWN0KHNpZ2J1ZmYyW2ldKS50b0JlKHNpZ2J1ZmZbaV0pO1xuICB9XG4gIGNvbnN0IHNpZ2J1ZmZzdHI6c3RyaW5nID0gYmludG9vbHMuYnVmZmVyVG9CNTgoc2lnYnVmZik7XG4gIGV4cGVjdChzaWcudG9TdHJpbmcoKSkudG9CZShzaWdidWZmc3RyKTtcbiAgc2lnLmZyb21TdHJpbmcoc2lnYnVmZnN0cik7XG4gIGV4cGVjdChzaWcudG9TdHJpbmcoKSkudG9CZShzaWdidWZmc3RyKTtcbn0pO1xuXG5kZXNjcmliZSgnU2lnSWR4JywgKCkgPT4ge1xuICBjb25zdCBzaWdpZHg6U2lnSWR4ID0gbmV3IFNpZ0lkeCgpO1xuICBleHBlY3Qoc2lnaWR4LmdldFNpemUoKSkudG9CZShzaWdpZHgudG9CdWZmZXIoKS5sZW5ndGgpO1xuICBzaWdpZHguc2V0U291cmNlKEJ1ZmZlci5mcm9tKCdhYmNkJywgJ2hleCcpKTtcbiAgZXhwZWN0KHNpZ2lkeC5nZXRTb3VyY2UoKS50b1N0cmluZygnaGV4JykpLnRvQmUoJ2FiY2QnKTtcbn0pO1xuXG5kZXNjcmliZSgnQWRkcmVzcycsICgpID0+IHtcbiAgY29uc3QgYWRkcjEgPSBuZXcgQWRkcmVzcygpO1xuICBjb25zdCBhZGRyMiA9IG5ldyBBZGRyZXNzKCk7XG4gIGNvbnN0IHNtYWxsZXI6QXJyYXk8bnVtYmVyPiA9IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCA5LCA4LCA3LCA2LCA1LCA0LCAzLCAyLCAxLCAwXTtcbiAgY29uc3QgYmlnZ2VyOkFycmF5PG51bWJlcj4gPSBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgOSwgOCwgNywgNiwgNSwgNCwgMywgMiwgMSwgMV07XG4gIGNvbnN0IGFkZHIxYnl0ZXM6QnVmZmVyID0gQnVmZmVyLmZyb20oc21hbGxlcik7XG4gIGNvbnN0IGFkZHIyYnl0ZXM6QnVmZmVyID0gQnVmZmVyLmZyb20oYmlnZ2VyKTtcbiAgYWRkcjEuZnJvbUJ1ZmZlcihhZGRyMWJ5dGVzKTtcbiAgYWRkcjIuZnJvbUJ1ZmZlcihhZGRyMmJ5dGVzKTtcbiAgZXhwZWN0KEFkZHJlc3MuY29tcGFyYXRvcigpKGFkZHIxLCBhZGRyMikpLnRvQmUoLTEpO1xuICBleHBlY3QoQWRkcmVzcy5jb21wYXJhdG9yKCkoYWRkcjIsIGFkZHIxKSkudG9CZSgxKTtcblxuICBjb25zdCBhZGRyMnN0cjpzdHJpbmcgPSBhZGRyMi50b1N0cmluZygpO1xuXG4gIGFkZHIyLmZyb21CdWZmZXIoYWRkcjFieXRlcyk7XG4gIGV4cGVjdChBZGRyZXNzLmNvbXBhcmF0b3IoKShhZGRyMSwgYWRkcjIpKS50b0JlKDApO1xuXG4gIGFkZHIyLmZyb21TdHJpbmcoYWRkcjJzdHIpO1xuICBleHBlY3QoQWRkcmVzcy5jb21wYXJhdG9yKCkoYWRkcjEsIGFkZHIyKSkudG9CZSgtMSk7XG4gIGNvbnN0IGExYjpCdWZmZXIgPSBhZGRyMS50b0J1ZmZlcigpO1xuICBjb25zdCBhMXM6c3RyaW5nID0gYmludG9vbHMuYnVmZmVyVG9CNTgoYTFiKTtcbiAgYWRkcjIuZnJvbVN0cmluZyhhMXMpO1xuICBleHBlY3QoQWRkcmVzcy5jb21wYXJhdG9yKCkoYWRkcjEsIGFkZHIyKSkudG9CZSgwKTtcblxuICBjb25zdCBiYWRidWZmOkJ1ZmZlciA9IGJpbnRvb2xzLmNvcHlGcm9tKGFkZHIxYnl0ZXMpO1xuICBsZXQgYmFkYnVmZm91dDpCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtiYWRidWZmLCBCdWZmZXIuZnJvbShbMSwgMl0pXSk7XG4gIGxldCBiYWRzdHI6c3RyaW5nID0gYmludG9vbHMuYnVmZmVyVG9CNTgoYmFkYnVmZm91dCk7XG4gIGNvbnN0IGJhZGFkZHI6QWRkcmVzcyA9IG5ldyBBZGRyZXNzKCk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBiYWRhZGRyLmZyb21TdHJpbmcoYmFkc3RyKTtcbiAgfSkudG9UaHJvdygnRXJyb3IgLSBBZGRyZXNzLmZyb21TdHJpbmc6IGludmFsaWQgYWRkcmVzcycpO1xuXG4gIGJhZGJ1ZmZvdXQgPSBCdWZmZXIuY29uY2F0KFtiYWRidWZmLCBCdWZmZXIuZnJvbShbMSwgMiwgMywgNF0pXSk7XG4gIGJhZHN0ciA9IGJpbnRvb2xzLmJ1ZmZlclRvQjU4KGJhZGJ1ZmZvdXQpO1xuICBleHBlY3QoKCkgPT4ge1xuICAgIGJhZGFkZHIuZnJvbVN0cmluZyhiYWRzdHIpO1xuICB9KS50b1Rocm93KCdFcnJvciAtIEFkZHJlc3MuZnJvbVN0cmluZzogaW52YWxpZCBjaGVja3N1bSBvbiBhZGRyZXNzJyk7XG59KTtcbiJdfQ==