"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const bn_js_1 = __importDefault(require("bn.js"));
const bintools_1 = __importDefault(require("src/utils/bintools"));
const outputs_1 = require("src/apis/avm/outputs");
const bintools = bintools_1.default.getInstance();
describe('Outputs', () => {
    describe('NFTMintOutput', () => {
        let addrs = [
            bintools.cb58Decode("B6D4v1VtPYLbiUvYXtW4Px8oE9imC2vGW"),
            bintools.cb58Decode("P5wdRuZeaDt28eHMP5S3w9ZdoBfo7wuzF"),
            bintools.cb58Decode("6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV")
        ].sort();
        let locktime = new bn_js_1.default(54321);
        let addrpay = [addrs[0], addrs[1]];
        let fallLocktime = locktime.add(new bn_js_1.default(50));
        test('SelectOutputClass', () => {
            let goodout = new outputs_1.NFTMintOutput(0, addrpay, fallLocktime, 1);
            let outpayment = outputs_1.SelectOutputClass(goodout.getOutputID());
            expect(outpayment).toBeInstanceOf(outputs_1.NFTMintOutput);
            expect(() => {
                outputs_1.SelectOutputClass(99);
            }).toThrow("Error - SelectOutputClass: unknown outputid");
        });
        test('comparator', () => {
            let outpayment1 = new outputs_1.NFTMintOutput(1, addrs, fallLocktime, 1);
            let outpayment2 = new outputs_1.NFTMintOutput(2, addrs, fallLocktime, 1);
            let outpayment3 = new outputs_1.NFTMintOutput(0, addrs, fallLocktime, 1);
            let cmp = outputs_1.Output.comparator();
            expect(cmp(outpayment1, outpayment1)).toBe(0);
            expect(cmp(outpayment2, outpayment2)).toBe(0);
            expect(cmp(outpayment3, outpayment3)).toBe(0);
            expect(cmp(outpayment1, outpayment2)).toBe(-1);
            expect(cmp(outpayment1, outpayment3)).toBe(1);
        });
        test('Functionality', () => {
            let out = new outputs_1.NFTMintOutput(0, addrs, fallLocktime, 3);
            expect(out.getOutputID()).toBe(10);
            expect(JSON.stringify(out.getAddresses().sort())).toStrictEqual(JSON.stringify(addrs.sort()));
            expect(out.getThreshold()).toBe(3);
            // expect(out.getLocktime().toNumber()).toBe(locktime.toNumber());
            let r = out.getAddressIdx(addrs[2]);
            expect(out.getAddress(r)).toStrictEqual(addrs[2]);
            expect(() => {
                out.getAddress(400);
            }).toThrow();
            let b = out.toBuffer();
            expect(out.toString()).toBe(bintools.bufferToB58(b));
            let s = out.getSpenders(addrs);
            expect(JSON.stringify(s.sort())).toBe(JSON.stringify(addrs.sort()));
            let m1 = out.meetsThreshold([addrs[0]]);
            expect(m1).toBe(false);
            let m2 = out.meetsThreshold(addrs, new bn_js_1.default(100));
            expect(m2).toBe(false);
            let m3 = out.meetsThreshold(addrs);
            expect(m3).toBe(true);
            let m4 = out.meetsThreshold(addrs, locktime.add(new bn_js_1.default(100)));
            expect(m4).toBe(true);
        });
    });
    describe('SecpOutput', () => {
        let addrs = [
            bintools.cb58Decode("B6D4v1VtPYLbiUvYXtW4Px8oE9imC2vGW"),
            bintools.cb58Decode("P5wdRuZeaDt28eHMP5S3w9ZdoBfo7wuzF"),
            bintools.cb58Decode("6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV")
        ].sort();
        let locktime = new bn_js_1.default(54321);
        let addrpay = [addrs[0], addrs[1]];
        let fallLocktime = locktime.add(new bn_js_1.default(50));
        test('SelectOutputClass', () => {
            let goodout = new outputs_1.SecpOutput(new bn_js_1.default(2600), addrpay, fallLocktime, 1);
            let outpayment = outputs_1.SelectOutputClass(goodout.getOutputID());
            expect(outpayment).toBeInstanceOf(outputs_1.SecpOutput);
            expect(() => {
                outputs_1.SelectOutputClass(99);
            }).toThrow("Error - SelectOutputClass: unknown outputid");
        });
        test('comparator', () => {
            let outpayment1 = new outputs_1.SecpOutput(new bn_js_1.default(10000), addrs, locktime, 3);
            let outpayment2 = new outputs_1.SecpOutput(new bn_js_1.default(10001), addrs, locktime, 3);
            let outpayment3 = new outputs_1.SecpOutput(new bn_js_1.default(9999), addrs, locktime, 3);
            let cmp = outputs_1.Output.comparator();
            expect(cmp(outpayment1, outpayment1)).toBe(0);
            expect(cmp(outpayment2, outpayment2)).toBe(0);
            expect(cmp(outpayment3, outpayment3)).toBe(0);
            expect(cmp(outpayment1, outpayment2)).toBe(-1);
            expect(cmp(outpayment1, outpayment3)).toBe(1);
        });
        test('SecpOutput', () => {
            let out = new outputs_1.SecpOutput(new bn_js_1.default(10000), addrs, locktime, 3);
            expect(out.getOutputID()).toBe(7);
            expect(JSON.stringify(out.getAddresses().sort())).toStrictEqual(JSON.stringify(addrs.sort()));
            expect(out.getThreshold()).toBe(3);
            expect(out.getLocktime().toNumber()).toBe(locktime.toNumber());
            let r = out.getAddressIdx(addrs[2]);
            expect(out.getAddress(r)).toStrictEqual(addrs[2]);
            expect(() => {
                out.getAddress(400);
            }).toThrow();
            expect(out.getAmount().toNumber()).toBe(10000);
            let b = out.toBuffer();
            expect(out.toString()).toBe(bintools.bufferToB58(b));
            let s = out.getSpenders(addrs);
            expect(JSON.stringify(s.sort())).toBe(JSON.stringify(addrs.sort()));
            let m1 = out.meetsThreshold([addrs[0]]);
            expect(m1).toBe(false);
            let m2 = out.meetsThreshold(addrs, new bn_js_1.default(100));
            expect(m2).toBe(false);
            let m3 = out.meetsThreshold(addrs);
            expect(m3).toBe(true);
            let m4 = out.meetsThreshold(addrs, locktime.add(new bn_js_1.default(100)));
            expect(m4).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0cHV0cy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdHMvYXBpcy9hdm0vb3V0cHV0cy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsa0RBQXVCO0FBRXZCLGtFQUEwQztBQUMxQyxrREFBNEY7QUFFNUYsTUFBTSxRQUFRLEdBQUcsa0JBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUV4QyxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtJQUNyQixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixJQUFJLEtBQUssR0FBaUI7WUFDdEIsUUFBUSxDQUFDLFVBQVUsQ0FBQyxtQ0FBbUMsQ0FBQztZQUN4RCxRQUFRLENBQUMsVUFBVSxDQUFDLG1DQUFtQyxDQUFDO1lBQ3hELFFBQVEsQ0FBQyxVQUFVLENBQUMsbUNBQW1DLENBQUM7U0FDM0QsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVULElBQUksUUFBUSxHQUFNLElBQUksZUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksWUFBWSxHQUFNLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxlQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUvQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1lBQzNCLElBQUksT0FBTyxHQUFpQixJQUFJLHVCQUFhLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0UsSUFBSSxVQUFVLEdBQVUsMkJBQWlCLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7WUFDakUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyx1QkFBYSxDQUFDLENBQUM7WUFDakQsTUFBTSxDQUFDLEdBQUcsRUFBRTtnQkFDUiwyQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsNkNBQTZDLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1lBQ3BCLElBQUksV0FBVyxHQUFVLElBQUksdUJBQWEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RSxJQUFJLFdBQVcsR0FBVSxJQUFJLHVCQUFhLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdEUsSUFBSSxXQUFXLEdBQVUsSUFBSSx1QkFBYSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3RFLElBQUksR0FBRyxHQUFHLGdCQUFNLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1lBQ3ZCLElBQUksR0FBRyxHQUFpQixJQUFJLHVCQUFhLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDckUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFOUYsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuQyxrRUFBa0U7WUFFbEUsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNSLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDdkIsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFYixJQUFJLENBQUMsR0FBVSxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFckQsSUFBSSxDQUFDLEdBQWlCLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBRXBFLElBQUksRUFBRSxHQUFXLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkIsSUFBSSxFQUFFLEdBQVcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxlQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3ZCLElBQUksRUFBRSxHQUFXLEdBQUcsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QixJQUFJLEVBQUUsR0FBVyxHQUFHLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksZUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUE7SUFFRixRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtRQUMxQixJQUFJLEtBQUssR0FBaUI7WUFDdEIsUUFBUSxDQUFDLFVBQVUsQ0FBQyxtQ0FBbUMsQ0FBQztZQUN4RCxRQUFRLENBQUMsVUFBVSxDQUFDLG1DQUFtQyxDQUFDO1lBQ3hELFFBQVEsQ0FBQyxVQUFVLENBQUMsbUNBQW1DLENBQUM7U0FDM0QsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVULElBQUksUUFBUSxHQUFNLElBQUksZUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksWUFBWSxHQUFNLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxlQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUvQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1lBQzNCLElBQUksT0FBTyxHQUFjLElBQUksb0JBQVUsQ0FBQyxJQUFJLGVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2hGLElBQUksVUFBVSxHQUFVLDJCQUFpQixDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxjQUFjLENBQUMsb0JBQVUsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1IsMkJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtZQUNwQixJQUFJLFdBQVcsR0FBVSxJQUFJLG9CQUFVLENBQUMsSUFBSSxlQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMzRSxJQUFJLFdBQVcsR0FBVSxJQUFJLG9CQUFVLENBQUMsSUFBSSxlQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMzRSxJQUFJLFdBQVcsR0FBVSxJQUFJLG9CQUFVLENBQUMsSUFBSSxlQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxRSxJQUFJLEdBQUcsR0FBRyxnQkFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtZQUNwQixJQUFJLEdBQUcsR0FBYyxJQUFJLG9CQUFVLENBQUMsSUFBSSxlQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN2RSxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztZQUU5RixNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFFL0QsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNSLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDdkIsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFYixNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRS9DLElBQUksQ0FBQyxHQUFVLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUM5QixNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVyRCxJQUFJLENBQUMsR0FBaUIsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFcEUsSUFBSSxFQUFFLEdBQVcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN2QixJQUFJLEVBQUUsR0FBVyxHQUFHLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLGVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkIsSUFBSSxFQUFFLEdBQVcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMzQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksRUFBRSxHQUFXLEdBQUcsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxlQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJOIGZyb20gJ2JuLmpzJztcbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlci8nO1xuaW1wb3J0IEJpblRvb2xzIGZyb20gJ3NyYy91dGlscy9iaW50b29scyc7XG5pbXBvcnQgeyBPdXRwdXQsIFNlY3BPdXRwdXQsIFNlbGVjdE91dHB1dENsYXNzLCBORlRNaW50T3V0cHV0IH0gZnJvbSAnc3JjL2FwaXMvYXZtL291dHB1dHMnO1xuXG5jb25zdCBiaW50b29scyA9IEJpblRvb2xzLmdldEluc3RhbmNlKCk7XG5cbmRlc2NyaWJlKCdPdXRwdXRzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdORlRNaW50T3V0cHV0JywgKCkgPT4ge1xuICAgICAgbGV0IGFkZHJzOkFycmF5PEJ1ZmZlcj4gPSBbXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShcIkI2RDR2MVZ0UFlMYmlVdllYdFc0UHg4b0U5aW1DMnZHV1wiKSxcbiAgICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKFwiUDV3ZFJ1WmVhRHQyOGVITVA1UzN3OVpkb0Jmbzd3dXpGXCIpLFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoXCI2WTNreXNqRjlqbkhuWWtkUzl5R0F1b0h5YWUyZU5tZVZcIilcbiAgICAgIF0uc29ydCgpO1xuXG4gICAgICBsZXQgbG9ja3RpbWU6Qk4gPSBuZXcgQk4oNTQzMjEpO1xuICAgICAgbGV0IGFkZHJwYXkgPSBbYWRkcnNbMF0sIGFkZHJzWzFdXTtcbiAgICAgIGxldCBmYWxsTG9ja3RpbWU6Qk4gPSBsb2NrdGltZS5hZGQobmV3IEJOKDUwKSk7XG5cbiAgICAgIHRlc3QoJ1NlbGVjdE91dHB1dENsYXNzJywgKCkgPT4ge1xuICAgICAgICAgIGxldCBnb29kb3V0Ok5GVE1pbnRPdXRwdXQgPSBuZXcgTkZUTWludE91dHB1dCgwLCBhZGRycGF5LCBmYWxsTG9ja3RpbWUsIDEpO1xuICAgICAgICAgIGxldCBvdXRwYXltZW50Ok91dHB1dCA9IFNlbGVjdE91dHB1dENsYXNzKGdvb2RvdXQuZ2V0T3V0cHV0SUQoKSk7XG4gICAgICAgICAgZXhwZWN0KG91dHBheW1lbnQpLnRvQmVJbnN0YW5jZU9mKE5GVE1pbnRPdXRwdXQpO1xuICAgICAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgICAgICAgIFNlbGVjdE91dHB1dENsYXNzKDk5KTtcbiAgICAgICAgICB9KS50b1Rocm93KFwiRXJyb3IgLSBTZWxlY3RPdXRwdXRDbGFzczogdW5rbm93biBvdXRwdXRpZFwiKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCdjb21wYXJhdG9yJywgKCkgPT4ge1xuICAgICAgICAgIGxldCBvdXRwYXltZW50MTpPdXRwdXQgPSBuZXcgTkZUTWludE91dHB1dCgxLCBhZGRycywgZmFsbExvY2t0aW1lLCAxKTtcbiAgICAgICAgICBsZXQgb3V0cGF5bWVudDI6T3V0cHV0ID0gbmV3IE5GVE1pbnRPdXRwdXQoMiwgYWRkcnMsIGZhbGxMb2NrdGltZSwgMSk7XG4gICAgICAgICAgbGV0IG91dHBheW1lbnQzOk91dHB1dCA9IG5ldyBORlRNaW50T3V0cHV0KDAsIGFkZHJzLCBmYWxsTG9ja3RpbWUsIDEpO1xuICAgICAgICAgIGxldCBjbXAgPSBPdXRwdXQuY29tcGFyYXRvcigpO1xuICAgICAgICAgIGV4cGVjdChjbXAob3V0cGF5bWVudDEsIG91dHBheW1lbnQxKSkudG9CZSgwKTtcbiAgICAgICAgICBleHBlY3QoY21wKG91dHBheW1lbnQyLCBvdXRwYXltZW50MikpLnRvQmUoMCk7XG4gICAgICAgICAgZXhwZWN0KGNtcChvdXRwYXltZW50Mywgb3V0cGF5bWVudDMpKS50b0JlKDApO1xuICAgICAgICAgIGV4cGVjdChjbXAob3V0cGF5bWVudDEsIG91dHBheW1lbnQyKSkudG9CZSgtMSk7XG4gICAgICAgICAgZXhwZWN0KGNtcChvdXRwYXltZW50MSwgb3V0cGF5bWVudDMpKS50b0JlKDEpO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ0Z1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgICAgICAgbGV0IG91dDpORlRNaW50T3V0cHV0ID0gbmV3IE5GVE1pbnRPdXRwdXQoMCwgYWRkcnMsIGZhbGxMb2NrdGltZSwgMyk7XG4gICAgICAgICAgZXhwZWN0KG91dC5nZXRPdXRwdXRJRCgpKS50b0JlKDEwKTtcbiAgICAgICAgICBleHBlY3QoSlNPTi5zdHJpbmdpZnkob3V0LmdldEFkZHJlc3NlcygpLnNvcnQoKSkpLnRvU3RyaWN0RXF1YWwoSlNPTi5zdHJpbmdpZnkoYWRkcnMuc29ydCgpKSk7XG5cbiAgICAgICAgICBleHBlY3Qob3V0LmdldFRocmVzaG9sZCgpKS50b0JlKDMpO1xuICAgICAgICAgIC8vIGV4cGVjdChvdXQuZ2V0TG9ja3RpbWUoKS50b051bWJlcigpKS50b0JlKGxvY2t0aW1lLnRvTnVtYmVyKCkpO1xuXG4gICAgICAgICAgbGV0IHIgPSBvdXQuZ2V0QWRkcmVzc0lkeChhZGRyc1syXSk7XG4gICAgICAgICAgZXhwZWN0KG91dC5nZXRBZGRyZXNzKHIpKS50b1N0cmljdEVxdWFsKGFkZHJzWzJdKTtcbiAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICBvdXQuZ2V0QWRkcmVzcyg0MDApXG4gICAgICAgICAgfSkudG9UaHJvdygpO1xuXG4gICAgICAgICAgbGV0IGI6QnVmZmVyID0gb3V0LnRvQnVmZmVyKCk7XG4gICAgICAgICAgZXhwZWN0KG91dC50b1N0cmluZygpKS50b0JlKGJpbnRvb2xzLmJ1ZmZlclRvQjU4KGIpKTtcblxuICAgICAgICAgIGxldCBzOkFycmF5PEJ1ZmZlcj4gPSBvdXQuZ2V0U3BlbmRlcnMoYWRkcnMpO1xuICAgICAgICAgIGV4cGVjdChKU09OLnN0cmluZ2lmeShzLnNvcnQoKSkpLnRvQmUoSlNPTi5zdHJpbmdpZnkoYWRkcnMuc29ydCgpKSk7XG5cbiAgICAgICAgICBsZXQgbTE6Ym9vbGVhbiA9IG91dC5tZWV0c1RocmVzaG9sZChbYWRkcnNbMF1dKTtcbiAgICAgICAgICBleHBlY3QobTEpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgIGxldCBtMjpib29sZWFuID0gb3V0Lm1lZXRzVGhyZXNob2xkKGFkZHJzLCBuZXcgQk4oMTAwKSk7XG4gICAgICAgICAgZXhwZWN0KG0yKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICBsZXQgbTM6Ym9vbGVhbiA9IG91dC5tZWV0c1RocmVzaG9sZChhZGRycyk7XG4gICAgICAgICAgZXhwZWN0KG0zKS50b0JlKHRydWUpO1xuICAgICAgICAgIGxldCBtNDpib29sZWFuID0gb3V0Lm1lZXRzVGhyZXNob2xkKGFkZHJzLCBsb2NrdGltZS5hZGQobmV3IEJOKDEwMCkpKTtcbiAgICAgICAgICBleHBlY3QobTQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ1NlY3BPdXRwdXQnLCAoKSA9PiB7XG4gICAgICBsZXQgYWRkcnM6QXJyYXk8QnVmZmVyPiA9IFtcbiAgICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKFwiQjZENHYxVnRQWUxiaVV2WVh0VzRQeDhvRTlpbUMydkdXXCIpLFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoXCJQNXdkUnVaZWFEdDI4ZUhNUDVTM3c5WmRvQmZvN3d1ekZcIiksXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShcIjZZM2t5c2pGOWpuSG5Za2RTOXlHQXVvSHlhZTJlTm1lVlwiKVxuICAgICAgXS5zb3J0KCk7XG5cbiAgICAgIGxldCBsb2NrdGltZTpCTiA9IG5ldyBCTig1NDMyMSk7XG4gICAgICBsZXQgYWRkcnBheSA9IFthZGRyc1swXSwgYWRkcnNbMV1dO1xuICAgICAgbGV0IGZhbGxMb2NrdGltZTpCTiA9IGxvY2t0aW1lLmFkZChuZXcgQk4oNTApKTtcblxuICAgICAgdGVzdCgnU2VsZWN0T3V0cHV0Q2xhc3MnLCAoKSA9PiB7XG4gICAgICAgICAgbGV0IGdvb2RvdXQ6U2VjcE91dHB1dCA9IG5ldyBTZWNwT3V0cHV0KG5ldyBCTigyNjAwKSwgYWRkcnBheSwgZmFsbExvY2t0aW1lLCAxKTtcbiAgICAgICAgICBsZXQgb3V0cGF5bWVudDpPdXRwdXQgPSBTZWxlY3RPdXRwdXRDbGFzcyhnb29kb3V0LmdldE91dHB1dElEKCkpO1xuICAgICAgICAgIGV4cGVjdChvdXRwYXltZW50KS50b0JlSW5zdGFuY2VPZihTZWNwT3V0cHV0KTtcbiAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICBTZWxlY3RPdXRwdXRDbGFzcyg5OSk7XG4gICAgICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gU2VsZWN0T3V0cHV0Q2xhc3M6IHVua25vd24gb3V0cHV0aWRcIik7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgnY29tcGFyYXRvcicsICgpID0+IHtcbiAgICAgICAgICBsZXQgb3V0cGF5bWVudDE6T3V0cHV0ID0gbmV3IFNlY3BPdXRwdXQobmV3IEJOKDEwMDAwKSwgYWRkcnMsIGxvY2t0aW1lLCAzKTtcbiAgICAgICAgICBsZXQgb3V0cGF5bWVudDI6T3V0cHV0ID0gbmV3IFNlY3BPdXRwdXQobmV3IEJOKDEwMDAxKSwgYWRkcnMsIGxvY2t0aW1lLCAzKTtcbiAgICAgICAgICBsZXQgb3V0cGF5bWVudDM6T3V0cHV0ID0gbmV3IFNlY3BPdXRwdXQobmV3IEJOKDk5OTkpLCBhZGRycywgbG9ja3RpbWUsIDMpO1xuICAgICAgICAgIGxldCBjbXAgPSBPdXRwdXQuY29tcGFyYXRvcigpO1xuICAgICAgICAgIGV4cGVjdChjbXAob3V0cGF5bWVudDEsIG91dHBheW1lbnQxKSkudG9CZSgwKTtcbiAgICAgICAgICBleHBlY3QoY21wKG91dHBheW1lbnQyLCBvdXRwYXltZW50MikpLnRvQmUoMCk7XG4gICAgICAgICAgZXhwZWN0KGNtcChvdXRwYXltZW50Mywgb3V0cGF5bWVudDMpKS50b0JlKDApO1xuICAgICAgICAgIGV4cGVjdChjbXAob3V0cGF5bWVudDEsIG91dHBheW1lbnQyKSkudG9CZSgtMSk7XG4gICAgICAgICAgZXhwZWN0KGNtcChvdXRwYXltZW50MSwgb3V0cGF5bWVudDMpKS50b0JlKDEpO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ1NlY3BPdXRwdXQnLCAoKSA9PiB7XG4gICAgICAgICAgbGV0IG91dDpTZWNwT3V0cHV0ID0gbmV3IFNlY3BPdXRwdXQobmV3IEJOKDEwMDAwKSwgYWRkcnMsIGxvY2t0aW1lLCAzKTtcbiAgICAgICAgICBleHBlY3Qob3V0LmdldE91dHB1dElEKCkpLnRvQmUoNyk7XG4gICAgICAgICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KG91dC5nZXRBZGRyZXNzZXMoKS5zb3J0KCkpKS50b1N0cmljdEVxdWFsKEpTT04uc3RyaW5naWZ5KGFkZHJzLnNvcnQoKSkpO1xuXG4gICAgICAgICAgZXhwZWN0KG91dC5nZXRUaHJlc2hvbGQoKSkudG9CZSgzKTtcbiAgICAgICAgICBleHBlY3Qob3V0LmdldExvY2t0aW1lKCkudG9OdW1iZXIoKSkudG9CZShsb2NrdGltZS50b051bWJlcigpKTtcblxuICAgICAgICAgIGxldCByID0gb3V0LmdldEFkZHJlc3NJZHgoYWRkcnNbMl0pO1xuICAgICAgICAgIGV4cGVjdChvdXQuZ2V0QWRkcmVzcyhyKSkudG9TdHJpY3RFcXVhbChhZGRyc1syXSk7XG4gICAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgb3V0LmdldEFkZHJlc3MoNDAwKVxuICAgICAgICAgIH0pLnRvVGhyb3coKTtcblxuICAgICAgICAgIGV4cGVjdChvdXQuZ2V0QW1vdW50KCkudG9OdW1iZXIoKSkudG9CZSgxMDAwMCk7XG5cbiAgICAgICAgICBsZXQgYjpCdWZmZXIgPSBvdXQudG9CdWZmZXIoKTtcbiAgICAgICAgICBleHBlY3Qob3V0LnRvU3RyaW5nKCkpLnRvQmUoYmludG9vbHMuYnVmZmVyVG9CNTgoYikpO1xuXG4gICAgICAgICAgbGV0IHM6QXJyYXk8QnVmZmVyPiA9IG91dC5nZXRTcGVuZGVycyhhZGRycyk7XG4gICAgICAgICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KHMuc29ydCgpKSkudG9CZShKU09OLnN0cmluZ2lmeShhZGRycy5zb3J0KCkpKTtcblxuICAgICAgICAgIGxldCBtMTpib29sZWFuID0gb3V0Lm1lZXRzVGhyZXNob2xkKFthZGRyc1swXV0pO1xuICAgICAgICAgIGV4cGVjdChtMSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgbGV0IG0yOmJvb2xlYW4gPSBvdXQubWVldHNUaHJlc2hvbGQoYWRkcnMsIG5ldyBCTigxMDApKTtcbiAgICAgICAgICBleHBlY3QobTIpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgIGxldCBtMzpib29sZWFuID0gb3V0Lm1lZXRzVGhyZXNob2xkKGFkZHJzKTtcbiAgICAgICAgICBleHBlY3QobTMpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgbGV0IG00OmJvb2xlYW4gPSBvdXQubWVldHNUaHJlc2hvbGQoYWRkcnMsIGxvY2t0aW1lLmFkZChuZXcgQk4oMTAwKSkpO1xuICAgICAgICAgIGV4cGVjdChtNCkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=