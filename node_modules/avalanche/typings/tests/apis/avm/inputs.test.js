"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const utxos_1 = require("src/apis/avm/utxos");
const keychain_1 = require("src/apis/avm/keychain");
const inputs_1 = require("src/apis/avm/inputs");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("src/utils/bintools"));
const bn_js_1 = __importDefault(require("bn.js"));
const buffer_1 = require("buffer/");
const outputs_1 = require("src/apis/avm/outputs");
const types_1 = require("src/apis/avm/types");
/**
 * @ignore
 */
const bintools = bintools_1.default.getInstance();
describe('Inputs', () => {
    let set;
    let keymgr1;
    let keymgr2;
    let addrs1;
    let addrs2;
    let utxos;
    let hrp = "tests";
    const amnt = 10000;
    beforeEach(() => {
        set = new utxos_1.UTXOSet();
        keymgr1 = new keychain_1.AVMKeyChain(hrp, 'X');
        keymgr2 = new keychain_1.AVMKeyChain(hrp, 'X');
        addrs1 = [];
        addrs2 = [];
        utxos = [];
        for (let i = 0; i < 3; i++) {
            addrs1.push(keymgr1.makeKey());
            addrs2.push(keymgr2.makeKey());
        }
        const amount = new bn_js_1.default(amnt);
        const addresses = keymgr1.getAddresses();
        const locktime = new bn_js_1.default(54321);
        const threshold = 3;
        for (let i = 0; i < 3; i++) {
            const txid = buffer_1.Buffer.from(create_hash_1.default('sha256').update(bintools.fromBNToBuffer(new bn_js_1.default(i), 32)).digest());
            const txidx = buffer_1.Buffer.from(bintools.fromBNToBuffer(new bn_js_1.default(i), 4));
            const assetID = buffer_1.Buffer.from(create_hash_1.default('sha256').update(txid).digest());
            const out = new outputs_1.SecpOutput(amount.add(new bn_js_1.default(i)), addresses, locktime, threshold);
            const xferout = new outputs_1.TransferableOutput(assetID, out);
            const u = new utxos_1.UTXO(types_1.AVMConstants.LATESTCODEC, txid, txidx, assetID, out);
            u.fromBuffer(buffer_1.Buffer.concat([u.getCodecIDBuffer(), txid, txidx, xferout.toBuffer()]));
            utxos.push(u);
        }
        set.addArray(utxos);
    });
    test('SecpInput', () => {
        let u;
        let txid;
        let txidx;
        const amount = new bn_js_1.default(amnt);
        let input;
        let xferinput;
        u = utxos[0];
        txid = u.getTxID();
        txidx = u.getOutputIdx();
        const asset = u.getAssetID();
        input = new inputs_1.SecpInput(amount);
        xferinput = new inputs_1.TransferableInput(txid, txidx, asset, input);
        expect(xferinput.getUTXOID()).toBe(u.getUTXOID());
        expect(input.getInputID()).toBe(types_1.AVMConstants.SECPINPUTID);
        input.addSignatureIdx(0, addrs2[0]);
        input.addSignatureIdx(1, addrs2[1]);
        const newin = new inputs_1.SecpInput();
        newin.fromBuffer(bintools.b58ToBuffer(input.toString()));
        expect(newin.toBuffer().toString('hex')).toBe(input.toBuffer().toString('hex'));
        expect(newin.getSigIdxs().toString()).toBe(input.getSigIdxs().toString());
    });
    test('Input comparator', () => {
        const inpt1 = new inputs_1.SecpInput(utxos[0].getOutput().getAmount());
        const inpt2 = new inputs_1.SecpInput(utxos[1].getOutput().getAmount());
        const inpt3 = new inputs_1.SecpInput(utxos[2].getOutput().getAmount());
        const cmp = inputs_1.Input.comparator();
        expect(cmp(inpt1, inpt2)).toBe(-1);
        expect(cmp(inpt1, inpt3)).toBe(-1);
        expect(cmp(inpt1, inpt1)).toBe(0);
        expect(cmp(inpt2, inpt2)).toBe(0);
        expect(cmp(inpt3, inpt3)).toBe(0);
    });
    test('TransferableInput comparator', () => {
        const inpt1 = new inputs_1.SecpInput(utxos[0].getOutput().getAmount());
        const in1 = new inputs_1.TransferableInput(utxos[0].getTxID(), utxos[0].getOutputIdx(), utxos[0].getAssetID(), inpt1);
        const inpt2 = new inputs_1.SecpInput(utxos[1].getOutput().getAmount());
        const in2 = new inputs_1.TransferableInput(utxos[1].getTxID(), utxos[1].getOutputIdx(), utxos[1].getAssetID(), inpt2);
        const inpt3 = new inputs_1.SecpInput(utxos[2].getOutput().getAmount());
        const in3 = new inputs_1.TransferableInput(utxos[2].getTxID(), utxos[2].getOutputIdx(), utxos[2].getAssetID(), inpt3);
        const cmp = inputs_1.TransferableInput.comparator();
        expect(cmp(in1, in2)).toBe(-1);
        expect(cmp(in1, in3)).toBe(-1);
        expect(cmp(in1, in1)).toBe(0);
        expect(cmp(in2, in2)).toBe(0);
        expect(cmp(in3, in3)).toBe(0);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90ZXN0cy9hcGlzL2F2bS9pbnB1dHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDhDQUFtRDtBQUNuRCxvREFBb0Q7QUFDcEQsZ0RBQTBFO0FBQzFFLDhEQUFxQztBQUNyQyxrRUFBMEM7QUFDMUMsa0RBQXVCO0FBQ3ZCLG9DQUFpQztBQUNqQyxrREFFOEI7QUFDOUIsOENBQWtEO0FBRWxEOztHQUVHO0FBQ0gsTUFBTSxRQUFRLEdBQUcsa0JBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUN4QyxRQUFRLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtJQUN0QixJQUFJLEdBQVcsQ0FBQztJQUNoQixJQUFJLE9BQW1CLENBQUM7SUFDeEIsSUFBSSxPQUFtQixDQUFDO0lBQ3hCLElBQUksTUFBb0IsQ0FBQztJQUN6QixJQUFJLE1BQW9CLENBQUM7SUFDekIsSUFBSSxLQUFpQixDQUFDO0lBQ3RCLElBQUksR0FBRyxHQUFVLE9BQU8sQ0FBQztJQUN6QixNQUFNLElBQUksR0FBVSxLQUFLLENBQUM7SUFDMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLEdBQUcsR0FBRyxJQUFJLGVBQU8sRUFBRSxDQUFDO1FBQ3BCLE9BQU8sR0FBRyxJQUFJLHNCQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sR0FBRyxJQUFJLHNCQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDWixNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNYLEtBQUssSUFBSSxDQUFDLEdBQVUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1NBQ2hDO1FBQ0QsTUFBTSxNQUFNLEdBQU0sSUFBSSxlQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsTUFBTSxTQUFTLEdBQWlCLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN2RCxNQUFNLFFBQVEsR0FBTSxJQUFJLGVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQyxNQUFNLFNBQVMsR0FBVSxDQUFDLENBQUM7UUFFM0IsS0FBSyxJQUFJLENBQUMsR0FBVSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxNQUFNLElBQUksR0FBVSxlQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxlQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzlHLE1BQU0sS0FBSyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUFJLGVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMscUJBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUMvRSxNQUFNLEdBQUcsR0FBVSxJQUFJLG9CQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLGVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDekYsTUFBTSxPQUFPLEdBQXNCLElBQUksNEJBQWtCLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sQ0FBQyxHQUFRLElBQUksWUFBSSxDQUFDLG9CQUFZLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzdFLENBQUMsQ0FBQyxVQUFVLENBQUMsZUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JGLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDZjtRQUNELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEIsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLENBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRTtRQUNyQixJQUFJLENBQU0sQ0FBQztRQUNYLElBQUksSUFBVyxDQUFDO1FBQ2hCLElBQUksS0FBWSxDQUFDO1FBQ2pCLE1BQU0sTUFBTSxHQUFNLElBQUksZUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9CLElBQUksS0FBZSxDQUFDO1FBQ3BCLElBQUksU0FBMkIsQ0FBQztRQUVoQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2IsSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQixLQUFLLEdBQUcsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3pCLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUU3QixLQUFLLEdBQUcsSUFBSSxrQkFBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlCLFNBQVMsR0FBRyxJQUFJLDBCQUFpQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRTFELEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXBDLE1BQU0sS0FBSyxHQUFhLElBQUksa0JBQVMsRUFBRSxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNoRixNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQzVFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUM1QixNQUFNLEtBQUssR0FBYSxJQUFJLGtCQUFTLENBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBbUIsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRTFGLE1BQU0sS0FBSyxHQUFhLElBQUksa0JBQVMsQ0FBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFtQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFFMUYsTUFBTSxLQUFLLEdBQWEsSUFBSSxrQkFBUyxDQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQW1CLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUUxRixNQUFNLEdBQUcsR0FBRyxjQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUN4QyxNQUFNLEtBQUssR0FBYSxJQUFJLGtCQUFTLENBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBbUIsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQzFGLE1BQU0sR0FBRyxHQUFxQixJQUFJLDBCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRS9ILE1BQU0sS0FBSyxHQUFhLElBQUksa0JBQVMsQ0FBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFtQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDMUYsTUFBTSxHQUFHLEdBQXFCLElBQUksMEJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFL0gsTUFBTSxLQUFLLEdBQWEsSUFBSSxrQkFBUyxDQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQW1CLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUMxRixNQUFNLEdBQUcsR0FBcUIsSUFBSSwwQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUvSCxNQUFNLEdBQUcsR0FBRywwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUMzQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVUWE9TZXQsIFVUWE8gfSBmcm9tICdzcmMvYXBpcy9hdm0vdXR4b3MnO1xuaW1wb3J0IHsgQVZNS2V5Q2hhaW4gfSBmcm9tICdzcmMvYXBpcy9hdm0va2V5Y2hhaW4nO1xuaW1wb3J0IHsgSW5wdXQsIFNlY3BJbnB1dCwgVHJhbnNmZXJhYmxlSW5wdXQgfSBmcm9tICdzcmMvYXBpcy9hdm0vaW5wdXRzJztcbmltcG9ydCBjcmVhdGVIYXNoIGZyb20gJ2NyZWF0ZS1oYXNoJztcbmltcG9ydCBCaW5Ub29scyBmcm9tICdzcmMvdXRpbHMvYmludG9vbHMnO1xuaW1wb3J0IEJOIGZyb20gJ2JuLmpzJztcbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlci8nO1xuaW1wb3J0IHtcbiAgT3V0cHV0LCBTZWNwT3V0cHV0LCBBbW91bnRPdXRwdXQsIFRyYW5zZmVyYWJsZU91dHB1dCxcbn0gZnJvbSAnc3JjL2FwaXMvYXZtL291dHB1dHMnO1xuaW1wb3J0IHsgQVZNQ29uc3RhbnRzIH0gZnJvbSAnc3JjL2FwaXMvYXZtL3R5cGVzJztcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmNvbnN0IGJpbnRvb2xzID0gQmluVG9vbHMuZ2V0SW5zdGFuY2UoKTtcbmRlc2NyaWJlKCdJbnB1dHMnLCAoKSA9PiB7XG4gIGxldCBzZXQ6VVRYT1NldDtcbiAgbGV0IGtleW1ncjE6QVZNS2V5Q2hhaW47XG4gIGxldCBrZXltZ3IyOkFWTUtleUNoYWluO1xuICBsZXQgYWRkcnMxOkFycmF5PEJ1ZmZlcj47XG4gIGxldCBhZGRyczI6QXJyYXk8QnVmZmVyPjtcbiAgbGV0IHV0eG9zOkFycmF5PFVUWE8+O1xuICBsZXQgaHJwOnN0cmluZyA9IFwidGVzdHNcIjtcbiAgY29uc3QgYW1udDpudW1iZXIgPSAxMDAwMDtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc2V0ID0gbmV3IFVUWE9TZXQoKTtcbiAgICBrZXltZ3IxID0gbmV3IEFWTUtleUNoYWluKGhycCwgJ1gnKTtcbiAgICBrZXltZ3IyID0gbmV3IEFWTUtleUNoYWluKGhycCwgJ1gnKTtcbiAgICBhZGRyczEgPSBbXTtcbiAgICBhZGRyczIgPSBbXTtcbiAgICB1dHhvcyA9IFtdO1xuICAgIGZvciAobGV0IGk6bnVtYmVyID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgYWRkcnMxLnB1c2goa2V5bWdyMS5tYWtlS2V5KCkpO1xuICAgICAgYWRkcnMyLnB1c2goa2V5bWdyMi5tYWtlS2V5KCkpO1xuICAgIH1cbiAgICBjb25zdCBhbW91bnQ6Qk4gPSBuZXcgQk4oYW1udCk7XG4gICAgY29uc3QgYWRkcmVzc2VzOkFycmF5PEJ1ZmZlcj4gPSBrZXltZ3IxLmdldEFkZHJlc3NlcygpO1xuICAgIGNvbnN0IGxvY2t0aW1lOkJOID0gbmV3IEJOKDU0MzIxKTtcbiAgICBjb25zdCB0aHJlc2hvbGQ6bnVtYmVyID0gMztcblxuICAgIGZvciAobGV0IGk6bnVtYmVyID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgY29uc3QgdHhpZDpCdWZmZXIgPSBCdWZmZXIuZnJvbShjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUoYmludG9vbHMuZnJvbUJOVG9CdWZmZXIobmV3IEJOKGkpLCAzMikpLmRpZ2VzdCgpKTtcbiAgICAgIGNvbnN0IHR4aWR4OkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJpbnRvb2xzLmZyb21CTlRvQnVmZmVyKG5ldyBCTihpKSwgNCkpO1xuICAgICAgY29uc3QgYXNzZXRJRDpCdWZmZXIgPSBCdWZmZXIuZnJvbShjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodHhpZCkuZGlnZXN0KCkpO1xuICAgICAgY29uc3Qgb3V0Ok91dHB1dCA9IG5ldyBTZWNwT3V0cHV0KGFtb3VudC5hZGQobmV3IEJOKGkpKSwgYWRkcmVzc2VzLCBsb2NrdGltZSwgdGhyZXNob2xkKTtcbiAgICAgIGNvbnN0IHhmZXJvdXQ6VHJhbnNmZXJhYmxlT3V0cHV0ID0gbmV3IFRyYW5zZmVyYWJsZU91dHB1dChhc3NldElELCBvdXQpO1xuICAgICAgY29uc3QgdTpVVFhPID0gbmV3IFVUWE8oQVZNQ29uc3RhbnRzLkxBVEVTVENPREVDLCB0eGlkLCB0eGlkeCwgYXNzZXRJRCwgb3V0KTtcbiAgICAgIHUuZnJvbUJ1ZmZlcihCdWZmZXIuY29uY2F0KFt1LmdldENvZGVjSURCdWZmZXIoKSwgdHhpZCwgdHhpZHgsIHhmZXJvdXQudG9CdWZmZXIoKV0pKTtcbiAgICAgIHV0eG9zLnB1c2godSk7XG4gICAgfVxuICAgIHNldC5hZGRBcnJheSh1dHhvcyk7XG4gIH0pO1xuICB0ZXN0KCdTZWNwSW5wdXQnLCAoKSA9PiB7XG4gICAgbGV0IHU6VVRYTztcbiAgICBsZXQgdHhpZDpCdWZmZXI7XG4gICAgbGV0IHR4aWR4OkJ1ZmZlcjtcbiAgICBjb25zdCBhbW91bnQ6Qk4gPSBuZXcgQk4oYW1udCk7XG4gICAgbGV0IGlucHV0OlNlY3BJbnB1dDtcbiAgICBsZXQgeGZlcmlucHV0OlRyYW5zZmVyYWJsZUlucHV0O1xuXG4gICAgdSA9IHV0eG9zWzBdO1xuICAgIHR4aWQgPSB1LmdldFR4SUQoKTtcbiAgICB0eGlkeCA9IHUuZ2V0T3V0cHV0SWR4KCk7XG4gICAgY29uc3QgYXNzZXQgPSB1LmdldEFzc2V0SUQoKTtcblxuICAgIGlucHV0ID0gbmV3IFNlY3BJbnB1dChhbW91bnQpO1xuICAgIHhmZXJpbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dCh0eGlkLCB0eGlkeCwgYXNzZXQsIGlucHV0KTtcbiAgICBleHBlY3QoeGZlcmlucHV0LmdldFVUWE9JRCgpKS50b0JlKHUuZ2V0VVRYT0lEKCkpO1xuICAgIGV4cGVjdChpbnB1dC5nZXRJbnB1dElEKCkpLnRvQmUoQVZNQ29uc3RhbnRzLlNFQ1BJTlBVVElEKTtcblxuICAgIGlucHV0LmFkZFNpZ25hdHVyZUlkeCgwLCBhZGRyczJbMF0pO1xuICAgIGlucHV0LmFkZFNpZ25hdHVyZUlkeCgxLCBhZGRyczJbMV0pO1xuXG4gICAgY29uc3QgbmV3aW46U2VjcElucHV0ID0gbmV3IFNlY3BJbnB1dCgpO1xuICAgIG5ld2luLmZyb21CdWZmZXIoYmludG9vbHMuYjU4VG9CdWZmZXIoaW5wdXQudG9TdHJpbmcoKSkpO1xuICAgIGV4cGVjdChuZXdpbi50b0J1ZmZlcigpLnRvU3RyaW5nKCdoZXgnKSkudG9CZShpbnB1dC50b0J1ZmZlcigpLnRvU3RyaW5nKCdoZXgnKSk7XG4gICAgZXhwZWN0KG5ld2luLmdldFNpZ0lkeHMoKS50b1N0cmluZygpKS50b0JlKGlucHV0LmdldFNpZ0lkeHMoKS50b1N0cmluZygpKTtcbiAgfSk7XG5cbiAgdGVzdCgnSW5wdXQgY29tcGFyYXRvcicsICgpID0+IHtcbiAgICBjb25zdCBpbnB0MTpTZWNwSW5wdXQgPSBuZXcgU2VjcElucHV0KCh1dHhvc1swXS5nZXRPdXRwdXQoKSBhcyBBbW91bnRPdXRwdXQpLmdldEFtb3VudCgpKTtcblxuICAgIGNvbnN0IGlucHQyOlNlY3BJbnB1dCA9IG5ldyBTZWNwSW5wdXQoKHV0eG9zWzFdLmdldE91dHB1dCgpIGFzIEFtb3VudE91dHB1dCkuZ2V0QW1vdW50KCkpO1xuXG4gICAgY29uc3QgaW5wdDM6U2VjcElucHV0ID0gbmV3IFNlY3BJbnB1dCgodXR4b3NbMl0uZ2V0T3V0cHV0KCkgYXMgQW1vdW50T3V0cHV0KS5nZXRBbW91bnQoKSk7XG5cbiAgICBjb25zdCBjbXAgPSBJbnB1dC5jb21wYXJhdG9yKCk7XG4gICAgZXhwZWN0KGNtcChpbnB0MSwgaW5wdDIpKS50b0JlKC0xKTtcbiAgICBleHBlY3QoY21wKGlucHQxLCBpbnB0MykpLnRvQmUoLTEpO1xuICAgIGV4cGVjdChjbXAoaW5wdDEsIGlucHQxKSkudG9CZSgwKTtcbiAgICBleHBlY3QoY21wKGlucHQyLCBpbnB0MikpLnRvQmUoMCk7XG4gICAgZXhwZWN0KGNtcChpbnB0MywgaW5wdDMpKS50b0JlKDApO1xuICB9KTtcblxuICB0ZXN0KCdUcmFuc2ZlcmFibGVJbnB1dCBjb21wYXJhdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IGlucHQxOlNlY3BJbnB1dCA9IG5ldyBTZWNwSW5wdXQoKHV0eG9zWzBdLmdldE91dHB1dCgpIGFzIEFtb3VudE91dHB1dCkuZ2V0QW1vdW50KCkpO1xuICAgIGNvbnN0IGluMTpUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dCh1dHhvc1swXS5nZXRUeElEKCksIHV0eG9zWzBdLmdldE91dHB1dElkeCgpLCB1dHhvc1swXS5nZXRBc3NldElEKCksIGlucHQxKTtcblxuICAgIGNvbnN0IGlucHQyOlNlY3BJbnB1dCA9IG5ldyBTZWNwSW5wdXQoKHV0eG9zWzFdLmdldE91dHB1dCgpIGFzIEFtb3VudE91dHB1dCkuZ2V0QW1vdW50KCkpO1xuICAgIGNvbnN0IGluMjpUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dCh1dHhvc1sxXS5nZXRUeElEKCksIHV0eG9zWzFdLmdldE91dHB1dElkeCgpLCB1dHhvc1sxXS5nZXRBc3NldElEKCksIGlucHQyKTtcblxuICAgIGNvbnN0IGlucHQzOlNlY3BJbnB1dCA9IG5ldyBTZWNwSW5wdXQoKHV0eG9zWzJdLmdldE91dHB1dCgpIGFzIEFtb3VudE91dHB1dCkuZ2V0QW1vdW50KCkpO1xuICAgIGNvbnN0IGluMzpUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dCh1dHhvc1syXS5nZXRUeElEKCksIHV0eG9zWzJdLmdldE91dHB1dElkeCgpLCB1dHhvc1syXS5nZXRBc3NldElEKCksIGlucHQzKTtcblxuICAgIGNvbnN0IGNtcCA9IFRyYW5zZmVyYWJsZUlucHV0LmNvbXBhcmF0b3IoKTtcbiAgICBleHBlY3QoY21wKGluMSwgaW4yKSkudG9CZSgtMSk7XG4gICAgZXhwZWN0KGNtcChpbjEsIGluMykpLnRvQmUoLTEpO1xuICAgIGV4cGVjdChjbXAoaW4xLCBpbjEpKS50b0JlKDApO1xuICAgIGV4cGVjdChjbXAoaW4yLCBpbjIpKS50b0JlKDApO1xuICAgIGV4cGVjdChjbXAoaW4zLCBpbjMpKS50b0JlKDApO1xuICB9KTtcbn0pO1xuIl19